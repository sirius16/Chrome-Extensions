
var FBHandler={isSession:false,accessToken:"",accessCode:"",authWindowID:null,avatarImageUrl:"",screenName:"",link:"",metaData:new Array(),initilizeFB:function(){FB.init({appId:Constants.FACEBOOK_APPID});FB.XD._origin="http://addthis.com";if(localStorage["FaceBookAccessToken"]&&localStorage["FaceBookAccessToken"]!=""){FBHandler.accessToken=localStorage["FaceBookAccessToken"];FBHandler.accessCode=localStorage["FaceBookAccessCode"];FBHandler.isSession=true;FBHandler.avatarImageUrl=localStorage["FaceBookAvatarImage"];FBHandler.screenName=localStorage["FaceBookDisplayName"];FBHandler.link=localStorage["FaceBookLink"];}},authenticate:function(){chrome.windows.create({url:Constants.FACEBOOK_OAUTH_URL+"?client_id="+Constants.FACEBOOK_APPID+"&redirect_uri="+Constants.FACEBOOK_REDIRECT_URL+"&scope="+Constants.FACEBOOK_PERMISSIONS,width:850,height:600},function(window){FBHandler.authWindowID=window.id;});},post:function(pageUrl,comment,title,pubID){if(comment=="Write Something...")
comment="";FB.api("/me/feed?access_token="+FBHandler.accessToken,"post",{link:pageUrl,message:comment},function(response){console.log(response);if(!response||response.error){if(response.error.message=="(#100) link URL is not properly formatted")
BootLoader.makePopupCall("btnFacebookSend","urlError");else{FBHandler.cleanAuthDetails();BootLoader.makePopupCall("btnFacebookSend","oAuthError");}}else{BootLoader.makePopupCall("btnFacebookSend","Success",{id:response.id});Track.trackShare("facebook",pubID,pageUrl,title);}});},fetchAccessToken:function(code){localStorage["FaceBookAccessCode"]=code;FBHandler.accessCode=code;$.ajax({url:Constants.FACEBOOK_GET_TOKEN_URL+code,cache:false,success:function(data){var token=data.split("=")[1].split("&")[0];localStorage["FaceBookAccessToken"]=token;FBHandler.accessToken=token;FBHandler.isSession=true;FBHandler.createAvatarImageUrl();}});},setAccessToken:function(){if(localStorage["AccessToken"]&&typeof(localStorage["AccessToken"])!=undefined)
FBHandler.accessToken=localStorage["AccessToken"];else
this.authenticate();},createAvatarImageUrl:function(){FB.api("/me?access_token="+FBHandler.accessToken,function(response){FBHandler.avatarImageUrl="https://graph.facebook.com/"+response.id+"/picture";FBHandler.screenName=response.name;FBHandler.link=response.link;localStorage["FaceBookLink"]=FBHandler.link;localStorage["FaceBookDisplayName"]=FBHandler.screenName;localStorage["FaceBookAvatarImage"]=FBHandler.avatarImageUrl;BootLoader.makeOptionsCall("btnOAuthFacebook","success");BootLoader.makePageCall("facebook");});},cleanAuthDetails:function(){FBHandler.accessToken="";localStorage["FaceBookAccessToken"]="";FBHandler.accessCode="";localStorage["FaceBookAccessCode"]="";FBHandler.isSession=false;FBHandler.avatarImageUrl="";localStorage["FaceBookAvatarImage"]="";FBHandler.screenName="";localStorage["FaceBookDisplayName"]="";}};