
var BootLoader={isAddThis:Util.isAddThis(),pubIDTabMap:new Array(),chromeNewTab:"chrome://newtab/",load:function(){ATX.log('BootLoader.load');Preferences.load();BootLoader._addEventListeners();TwitterHandler.init();FBHandler.initilizeFB();ATX.util.png();},loadServices:function(){Preferences.loadPreferredTargets();this._createContextMenu();},_createContextMenu:function(){if(Preferences.isContextMenu()){ATX.contextMenu.initialize();ContextMenu.init();}
else{ContextMenu.removeContextMenu();}},setIsAddThis:function(){isAddThis=Util.isAddThis();},_addEventListeners:function(){chrome.tabs.onUpdated.addListener(function(tabId,changeInfo,tab){var url=tab.url;if(url!=BootLoader.chromeNewTab&&tab.status=="complete"&&(url.indexOf("chrome-devtools")<0)&&(url.indexOf("chrome-extension")<0)){var secureDomains=new Array("http://","https://");var isSecureDomain=false;for(var i=0;i<secureDomains.length;i++){if(url.indexOf(secureDomains[i])>=0)
isSecureDomain=true;}
if(!isSecureDomain)
BootLoader.injectContentScript(tab.id);}});chrome.tabs.onRemoved.addListener(function(tabId,removeInfo){delete BootLoader.pubIDTabMap[tabId];});chrome.extension.onRequest.addListener(function(params,sender){if(params.message=="pubID"){BootLoader.pubIDTabMap[((typeof(sender)!="undefined"))&&(sender&&sender.tab&&sender.tab.id)?sender.tab.id:-1]=params.pubId?params.pubId:"";}else if(params.message=="setAccessToken"){if(params.requestParams.oauth_token&&params.requestParams.oauth_verifier){if(sender.tab.windowId==TwitterHandler.authWindowID)
chrome.windows.remove(TwitterHandler.authWindowID);TwitterHandler.getAccessToken(params.requestParams.oauth_verifier);}else{if(sender.tab.windowId==FBHandler.authWindowID)
chrome.windows.remove(sender.tab.windowId);FBHandler.fetchAccessToken(params.requestParams.code);}}else if(params.message=="metaTags"){FBHandler.metaData[(((typeof(sender)!="undefined"))&&(sender&&sender.tab&&sender.tab.id)?sender.tab.id:-1)]={title:(typeof(params.tags.title!=undefined)&&params.tags.title)?params.tags.title:sender.tab.title,description:(typeof(params.tags.description!=undefined)&&params.tags.description)?params.tags.description:"",url:(typeof(params.tags.url!=undefined)&&params.tags.url)?params.tags.url:sender.tab.url,image:(typeof(params.tags.image!=undefined)&&params.tags.image)?params.tags.image:""};}});},injectContentScript:function(tabID){chrome.tabs.executeScript(tabID!=null?tabID:null,{file:"js/ATX.chrome.content.general.js"});if(FBHandler.isSession&&Preferences.isSocialServices()&&Preferences.isFBAuthPreference()){chrome.tabs.executeScript(tabID!=null?tabID:null,{file:"js/ATX.chrome.content.meta.js"});}},makeOptionsCall:function(btnID,status,shareData){var arrViews=chrome.extension.getViews({type:"tab"});for(var int=0;int<arrViews.length;int++){if(arrViews[int].document.location.pathname=="/html/ATX.chrome.options.html")
if(status=="success")
arrViews[int].setButtonCSS(btnID,"Disconnect",{add:"btn-red",remove:"btn-grn"},shareData);else if(status=="Error Timestamp")
arrViews[int].showErrorMessage('Error Timestamp');}},makePopupCall:function(btnID,status){var arrViews=chrome.extension.getViews({type:"popup"});for(var int=0;int<arrViews.length;int++){if(arrViews[int].document.location.pathname==="/html/ATX.chrome.browserAction.html"){arrViews[int].BrowserAction.setButtonCSS(btnID,status);}}},makePageCall:function(service){chrome.tabs.executeScript(null,{file:"js/ATX.chrome.content.page.js"});}};var checkOnline=function(retry){if(!retry){var retry=0;}
if(!navigator.onLine&&retry<100){retry++;setTimeout(checkOnline,5000,retry);}else if(retry){location.reload();}else{Util.isAddThis()?addthis.addEventListener(Constants.ADDTHIS_READY,BootLoader.load):BootLoader.load();ATX.initialize();}};$(document).ready(function(){checkOnline();});